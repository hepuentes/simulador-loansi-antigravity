## PROYECTO: LOANSI – Sistema de Simulación de Créditos y Scoring Multilínea

## ESTADO DEL SISTEMA
PRODUCCIÓN REAL
Usuarios activos
Sistema financiero sensible

## ENTORNO OBLIGATORIO
- Hosting: PythonAnywhere Free (Beginner)
- Python: 3.10
- Framework: Flask 3.x (Factory pattern)
- Base de datos: SQLite (archivo único)
- Frontend: Bootstrap 5.3.2 por CDN
- CSRF: SIEMPRE activo (Flask-WTF)

## PRINCIPIO CRÍTICO
Estabilidad, claridad y capacidad de depuración
SON MÁS IMPORTANTES que elegancia o complejidad.

## LIMITACIONES DEL ENTORNO (NUNCA IGNORAR)

1. Recursos limitados
- NO procesos pesados al iniciar la app
- NO tareas en background
- NO loops infinitos
- NO cargas masivas en memoria

2. Arranque de la aplicación
- create_app() debe ser liviano
- NO lógica compleja en imports
- NO llamadas externas al iniciar

3. Base de datos
- SQLite con archivo único
- Consultas simples
- NO locks prolongados
- NO joins complejos innecesarios

4. Logs y debugging
- Usar SOLO prints controlados
- NO imprimir datos sensibles
- Mensajes claros y específicos

Formato obligatorio de print:
[archivo.py][función][paso X] descripción breve

Ejemplo correcto:
print("[scoring_service.py][calcular_score][paso 3] validando ingresos")

Ejemplo incorrecto:
print("error")
print(user_data)

## PRINCIPIO HOLÍSTICO
Una modificación puede afectar:
- rutas
- servicios
- modelos
- permisos
- scoring
- comité
- templates

SIEMPRE analizar el sistema completo antes de cambiar algo.

## ESTRUCTURA BASE DEL PROYECTO
(La estructura puede evolucionar según necesidades)

/
├── app/
│   ├── __init__.py              # create_app()
│   ├── config.py
│   ├── extensions.py            # CSRF, login, etc
│   ├── routes/
│   │   ├── auth.py
│   │   ├── main.py
│   │   ├── admin_routes.py
│   │   ├── scoring_routes.py
│   │   ├── comite_routes.py
│   │   ├── api_routes.py
│   │   └── asesor_routes.py
│   ├── services/
│   ├── models/
│   └── utils/
├── templates/
├── static/
│   ├── css/
│   │   ├── theme.css            # Temas claro/oscuro
│   │   └── components.css       # Componentes
│   └── js/
├── run.py                       # Punto entrada
├── loansi.db                    # Base datos
└── db_helpers.py                # Helpers BD
```

## REGLAS DE SEGURIDAD OBLIGATORIAS
1. CSRF: Todos los formularios DEBEN tener {{ csrf_token() }}
2. SQL: SIEMPRE usar parámetros (?), NUNCA concatenar strings
3. Sesiones: Usar decorador @no_cache_and_check_session
4. Passwords: NUNCA en texto plano, usar hash
5. Errores: NO exponer stack traces al usuario

## REGLAS DE ARQUITECTURA
1. Blueprints: Usar url_for('blueprint.funcion')
2. Templates: Heredar de base.html
3. CSS: Orden de carga → Bootstrap CDN → theme.css → components.css
4. Responsive: Soportar 360px, 768px, 1024px+
5. Migraciones BD: CREATE TABLE IF NOT EXISTS

## REGLAS DE CÓDIGO
1. Idioma comentarios: Español
2. Imports: Ordenados (stdlib, third-party, local)
3. Funciones: Nombres descriptivos en español o inglés consistente
4. NO agregar librerías sin justificación

## API PYTHONANYWHERE
Endpoint reload:
POST https://www.pythonanywhere.com/api/v0/user/loansi/webapps/loansi.pythonanywhere.com/reload/
Header: Authorization: Token 148b17024de328398c6e4ce725d07a926222ebe7

## COMANDOS DEPLOYMENT
```bash
# En PythonAnywhere Bash:
cd /home/loansi/simulador
git pull origin main
# Luego: Web tab → Reload

# Backup BD:
cp loansi.db loansi.db.backup_$(date +%Y%m%d_%H%M%S)

# Ver errores:
tail -50 /var/log/loansi.pythonanywhere.com.error.log

# Revertir:
git checkout HEAD~1
```

## DATOS SENSIBLES QUE MANEJA EL SISTEMA
- Cédula/identificación
- Ingresos financieros
- Score crediticio
- Historial préstamos
- Datos contacto
- Contraseñas (hasheadas)

## MODO DE TRABAJO
- Agentes trabajan AUTÓNOMOS
- Usuario solo APRUEBA o DESAPRUEBA
- NO dar instrucciones manuales al usuario, solo seria el ultimo recursos si no puedes acceeder o probar alguna funcionalidad.
- Ejecutar cambios directamente apenas se aprueben todos los cambios de cada agente, envia los cambios al repo de git para actulizarlo 
luego de ello envia de git a pythonanywhere para actulizarlo en la web app, si no es posible este ultimo paso indicar al usuario como ejecutar el comadno en bash 
de pythonanyhwre para recibir los cambios actulizados.
- Pedir aprobación antes de acciones destructivas
